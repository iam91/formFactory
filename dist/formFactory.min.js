!function(e,t){function n(e,t,n){e.attachEvent?e.attachEvent("on"+t,n):e.addEventListener?e.addEventListener(t,n,!1):e["on"+t]=n}function i(e){return e?(e.innerHTML="",this._base=e,this._isInit=!1,this._html=null,this._schema=null,this._getInfo=null,this._onfail=null,this._onsuccess=null,void(this._dependency=null)):(console.warn("FormFactory: An HTMLElement should be provided."),this._base=null,this)}var a=/[\u0391-\uFFE5]/g,s={template:"<label class='ff-label'>{label}</label><input class='ff-input ff-hint' type='{type}' name='{name}'><span class='ff-hint'>{hint}</span>",getInfo:function(e){return e.nextElementSibling},onfail:function(e,t){alert("Failed")},onsuccess:function(e,t){alert("Successful"),t&&t.submit()},condition:function(e){return this.value.trim()!==e?"Should be the same value as '"+this.name+"' field.":null}},r={HINT:"ff-hint",FAILED:"ff-failed",SUCCESS:"ff-success",BUTTON:"ff-btn"};RULES={required:{test:/^.+$/,warn:"This field can't be empty."},email:{test:/^[a-zA-Z0-9.!#$%&'*+\/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/,warn:"Please input a valid email address."},url:{test:/^((http|https):\/\/(\w+:{0,1}\w*@)?(\S+)|)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?$/,warn:"Please input a valid url."},ip:{test:/^((25[0-5]|2[0-4][0-9]|1[0-9]{2}|[0-9]{1,2})\.){3}(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[0-9]{1,2})$/i,warn:"Please input a valid ip address."},date:{test:/^\d{4}-\d{1,2}-\d{1,2}$/,warn:"Please input a date takes the form yyyy-mm-dd."},numeric:{test:/^[0-9]+$/,warn:"Numeric only."},alpha:{test:/^[a-z]+$/i,warn:"Alpha only."},alphaNumeric:{test:/^[a-z0-9]+$/i,warn:"Alpha numeric only."},lengthWithChinese:function(e,t){return{test:function(n){var i=new RegExp("^[a-z,A-Z,\\d]{"+e+","+t+"}$");return i.test(n.replace(a,"nn"))},warn:"Length should between "+e+" and "+t+"."}}};var o=function(e){return t.createElement(e)};i.prototype.config=function(e,t){if(this._base){if(!e)return console.warn("FormFactory: No schema provided."),this;if(t&&t.template&&!t.getInfo)return console.warn("FormFactory: A function returning the html element showing the information should be provided together with your html template!"),this;this._schema=e,this._html=t&&t.template||s.template,this._findInfo=t&&t.getInfo||s.getInfo,this._onfail=s.onfail,this._onsuccess=s.onsuccess,this._dependency={},this._render(),n(this._base,"focusin",this._handlerWrapper(this._focusHandler)),n(this._base,"focusout",this._handlerWrapper(this._focusHandler)),n(this._base,"click",this._handlerWrapper(this._clickHandler)),this._isInit=!0}return this},i.prototype.callback=function(e,t){return this._isInit&&(this._onfail=e||s.onfail,this._onsuccess=t||s.onsuccess),this},i.prototype.dependency=function(e){if(this._isInit){if(!(e instanceof Array))return this.dependency([e]);for(var t=0;t<e.length;t++){var n=e[t],i=n.relier;if(n.depended){var a=n.condition?n.condition:s.condition;if(this._dependency[i])this._dependency[i][n.depended]=a;else{var r={};r[n.depended]=a,this._dependency[i]=r}}}}return this},i.prototype._render=function(){var e=t.createDocumentFragment();for(var n in schema){var i=schema[n],a=i.label||"",s=i.show?"text":"password",l=i.hint||"",c=o("div"),h=this._html.replace(/\{label\}/,a).replace(/\{type\}/,s).replace(/\{name\}/,n).replace(/\{hint\}/,l);c.innerHTML=h,e.appendChild(c)}var u=o("input");u.type="submit",u.classList.add(r.BUTTON),e.appendChild(u),this._base.appendChild(e)},i.prototype._handlerWrapper=function(e){var t=this;return function(n){e.call(t,n)}},i.prototype._clickHandler=function(e){e.preventDefault();var t=e.target,n=t.type;if("submit"===n||"button"===n){for(var i=this._base.elements,a=!0,s=0;s<i.length;s++)if(i[s]!==t){var r=this._execValidation(i[s]);r||(a=!1)}a?this._onsuccess(e,this._base):this._onfail(e,this._base)}},i.prototype._focusHandler=function(e){var t=e.target;if("submit"!==t.type&&"button"!==t.type)if("focusin"===e.type){var n=this._schema[t.name].hint,i=r.HINT;this._changeState(t,n,i)}else"focusout"===e.type&&this._execValidation(t)},i.prototype._execValidation=function(e){var t=e.value.trim(),n=e.name,i=this._validator(this._schema[n].rules,t),a=!1,s=null,o=null;return i?(s=i,o=r.FAILED):(i=this._validateDepend(n,t),i?(s=i,o=r.FAILED):(s=this._schema[n].valid,o=r.SUCCESS,a=!0)),this._changeState(e,s,o),a},i.prototype._validateDepend=function(e,t){var n=null;if(this._dependency[e]){var i=this._dependency[e];for(var a in i){var s=this._base.elements[a];if(n=i[a].call(s,t))return n}}return n},i.prototype._validator=function(e,t){for(var n in e){var i=e[n].test,a=e[n].warn;if(i instanceof RegExp){if(!i.test(t))return a}else if(i instanceof Function&&!i(t))return a}},i.prototype._changeState=function(e,t,n){var i=this._findInfo(e);i.classList.remove(r.HINT),i.classList.remove(r.FAILED),i.classList.remove(r.SUCCESS),i.innerHTML=t,i.classList.add(n),e.classList.add(n)},"undefined"==typeof e.formFactory&&(e.formFactory=function(e){return new i(e)},e.formFactory.RULES=RULES)}(window,document);